<div class="home-container">
  <!-- HEADER -->
  <div class="header">
    <img 
      src="/logo-alertavision.png" 
      class="logo clickable" 
      alt="AlertaVisiÃ³n" 
      (click)="onLogoClick()"
      title="Ver estado de la baterÃ­a"
    />

    <div class="header-actions">
      <div class="profile-pill" (click)="toggleProfile()">
        <div class="avatar-mini">{{ userName.charAt(0) | uppercase }}</div>
        <div class="profile-text">
          <span class="lbl-user">{{ userName.split(' ')[0] }}</span>
          <span class="lbl-edit">Editar</span>
        </div>
      </div>

      <button class="logout-btn" (click)="logout()">
        <img
          src="https://cdn-icons-png.flaticon.com/512/1828/1828479.png"
          alt="Salir"
        />
      </button>
    </div>
  </div>

  <!-- SALUDO CON NOMBRE REAL -->
  <h1 class="greeting">
    Â¡Hola {{ userName }}! <br />
    Vamos a conducir juntos
  </h1>

  <!-- TARJETA ESTADO DE CONEXIÃ“N -->
  <div class="status-card glow-border">
    <!-- Estado conectado -->
    <div class="connection-status" *ngIf="lentesConectados">
      <div class="status-indicator connected">
        <span class="status-dot"></span>
        <span>Lentes conectados</span>
      </div>
      
      <!-- BaterÃ­a -->
      <div class="battery-display">
        <div class="battery-icon-wrapper" [class.low]="batteryLevel <= 20" [class.critical]="batteryLevel <= 5">
          <span class="battery-emoji">{{ getBatteryIcon() }}</span>
          <span class="battery-percent">{{ batteryLevel }}%</span>
        </div>
        <div class="battery-bar">
          <div class="battery-fill" 
               [style.width.%]="batteryLevel" 
               [style.background]="getBatteryColor()">
          </div>
        </div>
      </div>

      <!-- Alerta baterÃ­a baja -->
      <div class="low-battery-warning" *ngIf="batteryLevel <= 5">
        âš ï¸ Â¡BaterÃ­a crÃ­tica! Los lentes se pueden apagar
      </div>
    </div>

    <!-- Estado desconectado -->
    <div class="connection-status" *ngIf="!lentesConectados">
      <div class="status-indicator disconnected">
        <span class="status-dot"></span>
        <span>Lentes desconectados</span>
      </div>
      <p class="status-hint">Enciende tus lentes y acÃ©rcalos para vincular</p>
    </div>

    <!-- Botones de acciÃ³n -->
    <div class="action-buttons">
      <button 
        class="btn-connect" 
        (click)="onConnectLenses()"
        [disabled]="conectandoLentes">
        <span *ngIf="!conectandoLentes">
          {{ lentesConectados ? 'ğŸ”„ Reconectar' : 'ğŸ”— Conectar lentes' }}
        </span>
        <span *ngIf="conectandoLentes">Conectando...</span>
      </button>

      <!-- BotÃ³n silenciar alarma (solo visible si hay alarma activa) -->
      <button 
        class="btn-silence" 
        *ngIf="alarmaActiva"
        (click)="silenciarAlarma()">
        ğŸ”‡ Silenciar alarma
      </button>
    </div>

    <p class="error-text" *ngIf="errorConexionLentes">
      {{ errorConexionLentes }}
    </p>
  </div>

  <!-- TARJETA DETECTANDO FATIGAS -->
  <div class="monitor-card" *ngIf="lentesConectados">
    <div class="monitor-header">
      <span class="monitor-icon">ğŸ‘ï¸</span>
      <h2>Detectando fatigas</h2>
    </div>
    <p class="monitor-subtitle">MantÃ©n la concentraciÃ³n</p>
    
    <div class="monitor-bar">
      <div class="monitor-fill" [style.width.%]="fatigaLevel"></div>
    </div>
    <span class="monitor-status">{{ fatigaLevel }}% activo</span>
  </div>

  <!-- ESTADÃSTICAS RÃPIDAS -->
  <div class="quick-stats" *ngIf="lentesConectados">
    <div class="stat-card">
      <span class="stat-value">{{ alertasHoy }}</span>
      <span class="stat-label">Alertas hoy</span>
    </div>
    <div class="stat-card">
      <span class="stat-value">{{ tiempoConduccion }}</span>
      <span class="stat-label">Tiempo activo</span>
    </div>
  </div>
</div>

<!-- NAV INFERIOR -->
<nav class="bottom-nav">
  <div class="nav-btn active" (click)="goTo('home')">
    <img src="/fluent-color--home-32.svg" alt="Inicio" class="nav-icon" />
    <span>Inicio</span>
  </div>
  <div class="nav-btn" (click)="goTo('history')">
    <img src="/icon-park--history-query.svg" alt="Alertas" class="nav-icon" />
    <span>Alertas</span>
  </div>
  <div class="nav-btn" (click)="goTo('reports')">
    <img src="/iconoir--reports-solid.svg" alt="Reportes" class="nav-icon" />
    <span>Informes</span>
  </div>
</nav>

<!-- MODAL BATERÃA -->
<div class="modal-backdrop" *ngIf="showBatteryModal" (click)="closeBatteryModal()"></div>

<div class="battery-modal" *ngIf="showBatteryModal">
  <div class="modal-header">
    <h3>ğŸ”‹ Estado de los Lentes</h3>
    <button class="close-btn" (click)="closeBatteryModal()">âœ•</button>
  </div>

  <div class="modal-body">
    <div class="battery-big" [style.color]="getBatteryColor()">
      <span class="battery-icon-big">{{ getBatteryIcon() }}</span>
      <span class="battery-value">{{ batteryLevel }}%</span>
    </div>

    <div class="battery-bar-large">
      <div class="battery-fill-large" 
           [style.width.%]="batteryLevel"
           [style.background]="getBatteryColor()">
      </div>
    </div>

    <div class="status-info">
      <div class="info-row">
        <span class="info-label">Estado:</span>
        <span class="info-value" [class.connected]="lentesConectados">
          {{ lentesConectados ? 'âœ… Conectados' : 'âŒ Desconectados' }}
        </span>
      </div>
      <div class="info-row" *ngIf="lastBatteryUpdate">
        <span class="info-label">Actualizado:</span>
        <span class="info-value">{{ lastBatteryUpdate }}</span>
      </div>
    </div>

    <div class="battery-warning" *ngIf="batteryLevel <= 20">
      âš ï¸ BaterÃ­a baja. Carga tus lentes pronto.
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn-refresh" (click)="fetchBatteryLevel()">ğŸ”„ Actualizar</button>
    <button class="btn-close" (click)="closeBatteryModal()">Cerrar</button>
  </div>
</div>

<!-- MODAL PERFIL -->
<div class="modal-backdrop" *ngIf="showProfileModal" (click)="toggleProfile()"></div>

<div class="profile-modal" *ngIf="showProfileModal">
  <div class="modal-header">
    <div class="profile-avatar">{{ userName.charAt(0) | uppercase }}</div>
    <div class="profile-info">
      <h3>{{ userName }}</h3>
      <p>{{ userEmail }}</p>
    </div>
    <button class="close-btn" (click)="toggleProfile()">âœ•</button>
  </div>

  <div class="modal-body">
    <div class="form-group">
      <label>Nombre</label>
      <input type="text" [(ngModel)]="editData.nombre" placeholder="Tu nombre" />
    </div>

    <div class="form-group">
      <label>TelÃ©fono</label>
      <input type="text" [(ngModel)]="editData.telefono" placeholder="Ej: 099..." />
    </div>

    <div class="form-group">
      <label>Correo de RecuperaciÃ³n</label>
      <input type="email" [(ngModel)]="editData.email_recuperacion" placeholder="respaldo@gmail.com" />
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn-cancel" (click)="toggleProfile()">Cancelar</button>
    <button class="btn-save" (click)="saveProfile()">Guardar</button>
  </div>
</div>
