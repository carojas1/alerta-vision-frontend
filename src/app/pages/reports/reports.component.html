<div class="reports-container">
  <h1 class="title">Informes</h1>

  <div class="tabs">
    <button class="tab" [class.active]="activeTab==='diario'" (click)="setTab('diario')">Diario</button>
    <button class="tab" [class.active]="activeTab==='semanal'" (click)="setTab('semanal')">Semanal</button>
    <button class="tab" [class.active]="activeTab==='mensual'" (click)="setTab('mensual')">Mensual</button>
  </div>
  
  <div *ngIf="errorMsg" class="error">{{ errorMsg }}</div>

  <!-- GrÃ¡fico Diario -->
  <div class="chart-card" *ngIf="activeTab==='diario'">
    <canvas baseChart [type]="'bar'" [data]="barData" [options]="barOptions"></canvas>
    <div class="empty" *ngIf="!loading && (!barData.datasets[0].data || !barData.datasets[0].data.length)">
      ðŸ“Š No hay alertas hoy
    </div>
  </div>

  <!-- GrÃ¡fico Semanal -->
  <div class="chart-card" *ngIf="activeTab==='semanal'">
    <canvas baseChart [type]="'line'" [data]="lineData" [options]="lineOptions"></canvas>
    <div class="empty" *ngIf="!loading && (!lineData.datasets[0].data || !lineData.datasets[0].data.length)">
      ðŸ“ˆ No hay datos esta semana
    </div>
  </div>

  <!-- GrÃ¡fico Mensual -->
  <div class="chart-card" *ngIf="activeTab==='mensual'">
    <canvas baseChart [type]="'doughnut'" [data]="donutData" [options]="donutOptions"></canvas>
    <div class="empty" *ngIf="!loading && (!donutData.datasets[0].data || !donutData.datasets[0].data.length)">
      ðŸ“… No hay datos este mes
    </div>
  </div>

  <!-- KPIs -->
  <div class="kpis">
    <div class="kpi">
      <div class="label">Promedio</div>
      <div class="value">{{ promedioDia | number:'1.0-0' }}</div>
    </div>
    <div class="kpi">
      <div class="label">MÃ¡ximo</div>
      <div class="value">{{ mejorDia | number:'1.0-0' }}</div>
    </div>
    <div class="kpi">
      <div class="label">MÃ­nimo</div>
      <div class="value">{{ peorDia | number:'1.0-0' }}</div>
    </div>
  </div>

  <!-- Exportar Reporte -->
  <div class="export">
    <button class="btn-quick" (click)="exportarCorreoUsuario()" [disabled]="sending">
      <ng-container *ngIf="!sending; else sendingTemplate">
        <span class="btn-label">Enviar reporte a:</span>
        <span class="btn-user-name">{{ userName || 'Usuario' }}</span>
        <span class="btn-user-email">{{ userEmail || '...' }}</span>
      </ng-container>
      <ng-template #sendingTemplate>Enviando...</ng-template>
    </button>

    <div class="separator-text">o enviar a otro correo:</div>

    <div class="manual-group">
      <input type="email" placeholder="otro@correo.com" [(ngModel)]="email">
      <button (click)="exportarCorreoManual()" [disabled]="sending">Enviar</button>
    </div>

    <div class="export-msg" *ngIf="exportMsg">{{ exportMsg }}</div>
  </div>

  <!-- Ajustes -->
  <div class="settings-section">
    <h2 class="settings-title">Ajustes</h2>
    
    <div class="setting-item">
      <span>Modo Oscuro</span>
      <label class="toggle-switch">
        <input type="checkbox" [checked]="isDarkMode" (change)="toggleDarkMode()">
        <span class="slider"></span>
      </label>
    </div>
    
    <div class="setting-item">
      <span>Notificaciones</span>
      <label class="toggle-switch">
        <input type="checkbox" [checked]="notificationsEnabled" (change)="toggleNotifications()">
        <span class="slider"></span>
      </label>
    </div>
    
    <div class="setting-item contact">
      <span>Soporte</span>
      <a href="mailto:carojas@sudamericano.edu.ec" class="contact-link">carojas&#64;sudamericano.edu.ec</a>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Cargando datos...</div>
</div>

<nav class="bottom-nav">
  <div class="nav-btn" (click)="goTo('home')">
    <img src="/fluent-color--home-32.svg" alt="Inicio" class="nav-icon" /><span>Inicio</span>
  </div>
  <div class="nav-btn" (click)="goTo('history')">
    <img src="/icon-park--history-query.svg" alt="Alertas" class="nav-icon" /><span>Alertas</span>
  </div>
  <div class="nav-btn active" (click)="goTo('reports')">
    <img src="/iconoir--reports-solid.svg" alt="Reportes" class="nav-icon" /><span>Informes</span>
  </div>
</nav>